# HPTourism Portal v0.7.1 - Full Product Requirements Document (PRD)

> **Context for AI Agents**: This document serves as the "Gene Code" for the HPTourism Portal. If the codebase is lost, an AI Agent should be able to reconstruct the functional logic of the system using this PRD along with the Tech Stack definitions.

## 1. Product Overview
**Product Name**: HP Tourism Homestay Registration Portal
**Purpose**: To digitize and streamline the registration, renewal, and management of Homestay units in Himachal Pradesh.
**Users**:
1.  **Citizens (Property Owners)**: Apply for registration/certification.
2.  **Dept. Staff (DA/DTDO)**: Verify, Inspect, and Approve applications.
3.  **Admins**: Manage the platform.

## 2. Functional Requirements

### 2.1 User Accounts & Auth
- **Registration**: Citizens register with Mobile Number (Primary ID) and Password.
- **Login**: Mobile + Password. (With CAPTCHA support).
- **Session**: Secure, HTTP-only cookie sessions. 7-day persistence.
- **RBAC**: Users must be assigned a role upon creation. Staff users are created by Admin.

### 2.2 Application Lifecycle ( The "Golden Workflow" )
The application moves through these strict states:

1.  **DRAFT**: Owner is filling data. Not visible to Staff.
2.  **SUBMITTED**: Owner clicked "Submit". Locked for editing. Visible to DA.
3.  **UNDER_SCRUTINY**: DA has started review.
    - *Action*: **Send Back** (Revert to Draft with remarks for User to fix).
    - *Action*: **Forward for Inspection** (Passed Scrutiny).
4.  **INSPECTION_SCHEDULED**: Inspection Team assigned. Date set.
5.  **INSPECTION_COMPLETED**: Report uploaded.
6.  **DTDO_REVIEW**: DTDO reviews the Inspection Report.
    - *Action*: **Approve** (Generate Certificate).
    - *Action*: **Reject** (Close application).
7.  **APPROVED**: Certificate Generated. Publicly verifiable.

### 2.3 Form & Data Requirements
- **Property Details**: Name, Address, Category (Gold/Silver/Bronze), Room Count (Single/Double/Family).
- **Documents**:
    - ID Proof (Aadhaar/VoterID).
    - Land Papers (Jamabandi).
    - Building Plan / Architect Certificate.
    - Police Verification Character Certificate.
    - NOCs (if applicable).
- **Upload Constraints**: Max 5MB per file. PDF/JPG/PNG only.

### 2.4 Fee Calculation Logic
- **Registration Fee**:
    - New Registration: Fixed Base Fee + Per Room Fee (Varies by Location - Tribal vs Non-Tribal).
    - Renewal: Different Rate Table.
- **GST**: 18% applied on Total Fee.
- **Total Payable**: (Base + (Rooms * Rate)) * 1.18.

### 2.5 Payment Gateway (HimKosh)
- **Integration Mode**: S2S (Server-to-Server) Request Generation -> Client Redirect.
- **Security**: Request signed with Private Key (fsign). Response verified with checksum.
- **Heads**: Dynamic Account Head mapping based on District (DDO Code).

### 2.6 Certificate Generation
- **Format**: PDF.
- **Content**: Application ID, Owner Name, Address, Category, Issue Date, Expiry Date (2 years validity).
- **Output**: Downloadable by Owner. Verifiable via QR Code.

## 3. Non-Functional Requirements
1.  **Offline-Capable Installer**: The system must be deployable to a server *without* internet access (bundled `node_modules`).
2.  **Data Sovereignty**: All data must reside on the local server or designated state data center. No external cloud dependencies for core logic.
3.  **Auditability**: Every status change, login, and payment event must be logged in `audit_logs` table.
4.  **Performance**: Dashboard load < 2 seconds. document upload support up to 25MB total payload.

## 4. Interfaces
- **Citizen Dashboard**: List of My Applications, "Apply New" button, Notifications.
- **Staff Dashboard (DA/DTDO)**: Kanban or List view of Pending Applications. Filters by Status and District.
- **Public Portal**: "Track Application" (No login required), "Verify Certificate" (No login required).
